## 什么是分布式事务

### 什么是事务

在聊分布式事务之前我们先聊一般的事务（Transaction），简单来说事务指的是`访问并可能更新数据库中各种数据项的一个程序执行单元`，我们将一组对数据库的操作打包成一个事务，如果这组操作出了问题，事务将被回滚。

在本地事务的情况下，有四大特性：原子性、一致性、隔离性和持久性，统称ACID。

原子性（atomicity）。一个事务是一个不可分割的工作单位，事务中包括的操作要么都做，要么都不做。
一致性（consistency）。事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。
隔离性（isolation）。一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。
持久性（durability）。持久性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。



### 分布式事务的起源

随着互联网技术的发展，系统架构从单体到大集群，到SOA和微服务，无状态部分一直在细分业务模块将一个个服务抽离出来单独部署，既提高了扩展性和可用性，也降低了系统整体的复杂度。但无论这一部分怎么发展，有状态部分的处理一直是微服务头疼的地方，由于每个模块都独立了出来，当我们想要对一组数据进行更新的时候不能像单体那样在同一个层聚合多个dao进行操作，然后统一用一个事务管理起来，于是乎就出现了对分布式事务的需求。



### 分布式事务的核心问题

既然是事务，那么传统事务有的特性，分布式也应该需要保证。最无缝衔接的是持久性，因为也是存数据库的，持久性的问题数据库自身就能保证且与分布式无关；隔离性和实现方式有关系，XA模式会将相关资源锁住，隔离性会相对的有保障，但TCC/TAC会有提交的前后顺序的问题，在某种程度上说是读未提交也不过分，不过这些方法的差异这个后续我们还会讨论；但无论哪种实现最值得探讨的其实是原子性和一致性，因为在一般情况下，应用之间无法感知彼此的状态，就谈不上对同一组事务进行提交和保证其原子性和一致性了。基于这种情况，分布式事务通常都会有一个类似transaction manager（TM）的角色负责对事务进行统一管理并将资源进行更新，但至于怎么确认提交，是放在数据库层还是应用层，就是个很大的话题了。



